<ion-header [translucent]="true">
  <ion-toolbar color="primary" class="header-toolbar">
    <ion-title class="header-title">
      <ion-icon name="speedometer-outline" class="title-icon"></ion-icon>
      Tableau de Bord
    </ion-title>
    <ion-buttons slot="end">
      <ion-button fill="clear" (click)="refresh()" class="header-button">
        <ion-icon name="refresh-outline"></ion-icon>
      </ion-button>
      <ion-button fill="clear" (click)="logout()" class="header-button">
        <ion-icon name="log-out-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="dashboard-content">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Tableau de Bord</ion-title>
    </ion-toolbar>
  </ion-header>

  <div class="dashboard-container animate-fade-in">
    <!-- Enhanced Welcome Section -->
    <div class="welcome-section glass-card animate-slide-in-right" *ngIf="user">
      <div class="welcome-avatar">
        <ion-avatar class="user-avatar">
          <img
            [src]="user.photoURL || 'assets/default-avatar.png'"
            [alt]="user.displayName"
          />
        </ion-avatar>
        <div class="status-indicator active"></div>
      </div>
      <div class="welcome-content">
        <h1 class="welcome-title">
          Bonjour, {{user.displayName || 'Utilisateur'}} üëã
        </h1>
        <p class="welcome-subtitle">
          Voici un aper√ßu de vos documents automobiles
        </p>
        <div class="quick-stats">
          <span class="stat-pill">
            <ion-icon name="car-sport"></ion-icon>
            {{stats.totalCars}} v√©hicules
          </span>
          <span class="stat-pill">
            <ion-icon name="document-text"></ion-icon>
            {{stats.totalDocuments}} documents
          </span>
        </div>
      </div>
    </div>

    <!-- Enhanced Statistics Cards -->
    <div class="stats-section">
      <h2 class="section-title">
        <ion-icon name="analytics-outline"></ion-icon>
        Statistiques
      </h2>
      <div class="stats-grid animate-stagger">
        <ion-card class="stat-card cars gradient-primary" button>
          <ion-card-content>
            <div class="card-header">
              <div class="stat-icon-wrapper">
                <ion-icon name="car-sport"></ion-icon>
              </div>
              <ion-badge color="light">{{stats.totalCars}}</ion-badge>
            </div>
            <div class="stat-info">
              <h3>V√©hicules</h3>
              <p>Total enregistr√©s</p>
            </div>
            <div class="card-footer">
              <ion-icon name="chevron-forward"></ion-icon>
            </div>
          </ion-card-content>
        </ion-card>

        <ion-card class="stat-card documents gradient-success" button>
          <ion-card-content>
            <div class="card-header">
              <div class="stat-icon-wrapper">
                <ion-icon name="document-text"></ion-icon>
              </div>
              <ion-badge color="light">{{stats.activeDocuments}}</ion-badge>
            </div>
            <div class="stat-info">
              <h3>Documents</h3>
              <p>Total actifs</p>
            </div>
            <div class="card-footer">
              <ion-icon name="chevron-forward"></ion-icon>
            </div>
          </ion-card-content>
        </ion-card>

        <ion-card class="stat-card expired gradient-danger" button>
          <ion-card-content>
            <div class="card-header">
              <div class="stat-icon-wrapper">
                <ion-icon name="alert-circle"></ion-icon>
              </div>
              <ion-badge color="light">{{stats.expiredDocuments}}</ion-badge>
            </div>
            <div class="stat-info">
              <h3>Expir√©s</h3>
              <p>√Ä renouveler</p>
            </div>
            <div class="card-footer">
              <ion-icon name="chevron-forward"></ion-icon>
            </div>
          </ion-card-content>
        </ion-card>

        <ion-card class="stat-card expiring gradient-warning" button>
          <ion-card-content>
            <div class="card-header">
              <div class="stat-icon-wrapper">
                <ion-icon name="warning"></ion-icon>
              </div>
              <ion-badge color="light">{{stats.expiringInSevenDays}}</ion-badge>
            </div>
            <div class="stat-info">
              <h3>Bient√¥t</h3>
              <p>7 jours restants</p>
            </div>
            <div class="card-footer">
              <ion-icon name="chevron-forward"></ion-icon>
            </div>
          </ion-card-content>
        </ion-card>
      </div>
    </div>

    <!-- Enhanced Recent Expiring Documents -->
    <div
      class="expiring-section"
      *ngIf="stats.soonToExpireDocuments.length > 0"
    >
      <h2 class="section-title">
        <ion-icon name="time-outline"></ion-icon>
        Documents √† surveiller
      </h2>
      <ion-card class="expiring-card">
        <ion-card-content>
          <ion-list class="expiring-list animate-stagger">
            <ion-item
              *ngFor="let document of stats.soonToExpireDocuments"
              class="expiring-item item-interactive"
              lines="none"
            >
              <div slot="start" class="document-icon">
                <div
                  class="icon-wrapper"
                  [class]="getExpirationStatus(document.dateFin).color"
                >
                  <ion-icon
                    [name]="getDocumentIcon(document.typeDocument)"
                  ></ion-icon>
                </div>
              </div>
              <ion-label>
                <h3 class="document-title">{{document.typeDocument}}</h3>
                <p class="document-car">
                  <ion-icon name="car-sport-outline"></ion-icon>
                  {{document.matriculeCar}}
                </p>
                <div class="document-status">
                  <span
                    class="status-indicator"
                    [class]="getExpirationStatus(document.dateFin).color"
                  ></span>
                  {{getExpirationStatus(document.dateFin).message}}
                </div>
              </ion-label>
              <div slot="end" class="expiry-info">
                <ion-chip
                  [color]="getExpirationStatus(document.dateFin).color"
                  class="days-chip"
                >
                  {{getDaysUntilExpiration(document.dateFin)}}j
                </ion-chip>
                <ion-icon name="chevron-forward" color="medium"></ion-icon>
              </div>
            </ion-item>
          </ion-list>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Enhanced Quick Actions -->
    <div class="actions-section">
      <h2 class="section-title">
        <ion-icon name="rocket-outline"></ion-icon>
        Actions rapides
      </h2>
      <div class="quick-actions animate-stagger">
        <ion-card
          class="action-card cars-action"
          button
          routerLink="/tabs/cars"
        >
          <ion-card-content>
            <div class="action-icon">
              <ion-icon name="car-sport"></ion-icon>
            </div>
            <div class="action-content">
              <h3>V√©hicules</h3>
              <p>G√©rer votre flotte</p>
            </div>
            <ion-icon name="chevron-forward" class="action-arrow"></ion-icon>
          </ion-card-content>
        </ion-card>

        <ion-card
          class="action-card documents-action"
          button
          routerLink="/tabs/documents"
        >
          <ion-card-content>
            <div class="action-icon">
              <ion-icon name="document-text"></ion-icon>
            </div>
            <div class="action-content">
              <h3>Documents</h3>
              <p>Suivre les √©ch√©ances</p>
            </div>
            <ion-icon name="chevron-forward" class="action-arrow"></ion-icon>
          </ion-card-content>
        </ion-card>

        <ion-card
          class="action-card settings-action"
          button
          routerLink="/tabs/settings"
        >
          <ion-card-content>
            <div class="action-icon">
              <ion-icon name="settings"></ion-icon>
            </div>
            <div class="action-content">
              <h3>Param√®tres</h3>
              <p>Configurer l'app</p>
            </div>
            <ion-icon name="chevron-forward" class="action-arrow"></ion-icon>
          </ion-card-content>
        </ion-card>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="stats.totalCars === 0">
      <div class="empty-content">
        <ion-icon name="car-sport-outline" class="empty-icon"></ion-icon>
        <h2>Aucun v√©hicule enregistr√©</h2>
        <p>
          Commencez par ajouter votre premier v√©hicule pour g√©rer vos documents
          automobiles
        </p>
        <ion-button
          expand="block"
          color="primary"
          routerLink="/tabs/cars"
          class="button-large"
        >
          <ion-icon name="add" slot="start"></ion-icon>
          Ajouter un v√©hicule
        </ion-button>
      </div>
    </div>
  </div>

  <!-- Enhanced Floating Action Button -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed" class="enhanced-fab">
    <ion-fab-button color="primary" class="main-fab">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
    <ion-fab-list side="top">
      <ion-fab-button color="car-blue" routerLink="/tabs/cars">
        <ion-icon name="car-sport"></ion-icon>
      </ion-fab-button>
      <ion-fab-button color="car-green" routerLink="/tabs/documents">
        <ion-icon name="document-text"></ion-icon>
      </ion-fab-button>
    </ion-fab-list>
  </ion-fab>
</ion-content>
